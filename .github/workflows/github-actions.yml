name: Run Cypress Tests and Docker Image

on:
  schedule:
    - cron: '0 * * * *'  # Runs the job every hour at the 0th minute
  workflow_dispatch:

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository content to GitHub runner
      - name: Checkout repo content
        uses: actions/checkout@v2
      
      # Set environment variables from GitHub secrets
      - name: Set environment variables
        run: |
          echo "DATABRICKS_HOST=${{ secrets.DATABRICKS_HOST }}" >> $GITHUB_ENV
          echo "DATABRICKS_HTTP_PATH=${{ secrets.DATABRICKS_HTTP_PATH }}" >> $GITHUB_ENV
          echo "DATABRICKS_TOKEN=${{ secrets.DATABRICKS_TOKEN }}" >> $GITHUB_ENV

      # Install Docker
      - name: Install Docker
        run: |
          sudo apt-get update
          sudo apt-get install -y docker.io
          sudo systemctl enable docker
          sudo systemctl start docker
          

      # Run a Docker image from Docker Hub
      - name: Run Docker Image
        run: |
          sudo docker pull ${{ secrets.DOCKER_USER_NAME }}/cypress_test1:latest
          sudo docker run --env-file $GITHUB_ENV ${{ secrets.DOCKER_USER_NAME }}/cypress_test1:latest
