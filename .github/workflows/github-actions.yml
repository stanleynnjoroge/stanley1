name: Run Cypress Tests and Docker Image

on:
  schedule:
    - cron: '0 * * * *'  # Runs the job every hour at the 0th minute
  workflow_dispatch:

jobs:
  run-databricks-notebook:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository content to GitHub runner
      - name: Checkout repo content
        uses: actions/checkout@v2
      
      # Set environment variables from GitHub secrets
      - name: Set environment variables
        run: |
          echo "DATABRICKS_HOST=${{ secrets.DATABRICKS_HOST }}" >> $GITHUB_ENV
          echo "DATABRICKS_TOKEN=${{ secrets.DATABRICKS_TOKEN }}" >> $GITHUB_ENV
      - name: Run Databricks Notebook
        uses: databricks/run-notebook@v0
        with:
          databricks-host: ${{ secrets.DATABRICKS_HOST }}
          databricks-token: ${{ secrets.DATABRICKS_TOKEN }}
          local-notebook-path: "/Workspace/Users/stanley.nnjoroge@griffinglobaltech.com/Github-actions"
          existing-cluster-id: 1028-104457-wbmjdii
          base-parameters: '{"image": "ngangastanley/cypress_test1:latest"}'
    
